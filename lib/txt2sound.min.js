var txt2sound=function(a){return a.semitone=1.05946,a.channels=2,a}(txt2sound||{}),txt2sound=function(a){function b(a,b,c,d,e,f,g,h,i){this.sampleRate=isNaN(a)||a===null?this.sampleRate:a,this.frequency=isNaN(b)||b===null?this.frequency:b,this.samplesLeft=isNaN(c)||c===null?this.samplesLeft:c,this.osc=audioLib.Oscillator(this.sampleRate,this.frequency),this.osc.waveShape=h!=undefined?h:"sine",this.lfoAmount=isNaN(g)||g===null?this.lfoAmount:g,this.lfoFrequency=isNaN(f)||f===null?this.lfoFrequency:f;var j=isNaN(d)||d===null?10:d,k=isNaN(e)||e===null?100:e;this.lfo=audioLib.Oscillator(this.sampleRate,this.lfoFrequency),this.lfo.waveShape=i!=undefined?i:"sine",this.envelope=audioLib.ADSREnvelope(this.sampleRate),this.envelope.attack=j,this.envelope.release=this.envelope.releaseTime=k,this.envelope.state=0,this.envelope.triggerGate(!0)}return b.prototype={released:!1,releasePhase:!1,sampleRate:44100,frequency:440,sample:0,lfoAmount:0,lfoFrequency:0,samplesLeft:3e3,mix:.5,envelope:null,osc:null,lfo:null,generate:function(){return this.sample=0,this.envelope.state!==0&&this.samplesLeft--,this.samplesLeft<=0&&!this.released&&this.releasePhase===!1&&(this.releasePhase=!0,this.envelope.state=5),this.envelope.generate(),this.envelope.state===5&&(this.releasePhase=!0),this.releasePhase&&this.envelope.state===0&&this.released===!1?this.released=!0:this.released===!1&&this.frequency!==0&&(this.lfo.frequency!==0&&this.lfoAmount!==0&&(this.lfo.generate(),this.osc.fm=this.lfo.getMix()*this.lfoAmount),this.osc.generate(),this.sample=this.osc.getMix()*this.envelope.getMix()),this.sample},getMix:function(){return this.sample}},audioLib.generators("TextVoice",b),a}(txt2sound||{}),txt2sound=function(a){function b(a,b,c,d,e){this.sampleRate=isNaN(a)?44100:a,this.octave=isNaN(e)?4:e,this.key=d===undefined?"a":d,this.allPitches=this.getAllPitches(),this.keyPitches=this.getKeyPitches(),this.beatFactor=this.sampleRate/60,this.setTempo(isNaN(c)?120:c),this.reverb=audioLib.Reverb(this.sampleRate,2,1,.7,.8,.01),this.previousChars=new Array(this.previousSize);for(var f=0;f<this.previousSize;f++)this.previousChars[f]=" "}return b.prototype={sampleRate:44100,position:-1,leftSample:0,rightSample:0,octave:0,key:"a",isMinor:!1,tempo:120,allPitches:[],keyPitches:[],samplesLeft:0,beatLength:0,beatFactor:0,text:"",noteDuration:1,notesPerBeat:1,voices:[],compressor:null,noteAttack:10,noteLength:100,noteRelease:500,reverb:null,previousSize:30,previousChars:[],currentChar:"",charChanged:null,operator:0,quickNoteOn:!1,quickNoteCount:0,quickNoteLimit:3,operatorInterval:7,lfoFrequency:50,lfoAmount:0,waveShape:"sine",lfoWaveShape:"sine",generate:function(){this.samplesLeft--;if(this.samplesLeft<=0){this.samplesLeft=this.beatLength,this.quickNoteOn&&(this.samplesLeft=this.samplesLeft/2,this.quickNoteCount++,this.quickNoteCount>=this.quickNoteLimit&&(this.quickNoteCount=0,this.quickNoteOn=!1)),this.incrementPosition();var b=this.getPitchAtPosition(this.position),c=0;b===0&&this.operator===0&&(this.operator=this.getOperatorAtPosition(this.position),this.operator===2&&(this.quickNoteOn=!0,this.incrementPosition()),this.operator===3&&this.incrementPosition()),this.voices.push(this.getVoice(b));if(b!=0&&this.operator!=0){if(this.operator===1)b*=Math.pow(a.semitone,this.operatorInterval),this.voices.push(this.getVoice(b));else if(this.operator===3){var d=b*Math.pow(a.semitone,this.isMinor?3:4);this.voices.push(this.getVoice(d)),d=b*Math.pow(a.semitone,7),this.voices.push(this.getVoice(d))}this.operator=0}}var e=0;if(this.voices.length>0){var f=0,g=this.voices.length;for(f=g-1;f>=0;f--)this.voices[f].generate(),e+=this.voices[f].getMix()*.2,this.voices[f].released===!0&&this.voices.splice(f,1)}this.reverb.pushSample(e,0),this.reverb.pushSample(e,1),this.leftSample=this.reverb.getMix(0),this.rightSample=this.reverb.getMix(1)},getVoice:function(a){return audioLib.generators.TextVoice(this.sampleRate,a,this.noteLength+this.noteAttack,this.noteAttack,this.noteRelease,this.lfoFrequency,this.lfoAmount,this.waveShape,this.lfoWaveShape)},recordPreviousChar:function(){this.previousChars.push(this.currentChar),this.previousChars.splice(0,1),this.currentChar=this.text[this.position],this.charChanged!=null&&this.charChanged()},incrementPosition:function(){this.position++,this.position>=this.text.length&&(this.position=0),this.recordPreviousChar()},getMix:function(a){return a?this.leftSample:this.rightSample},setTempo:function(a){this.tempo=a,this.beatLength=Math.floor(this.noteDuration*this.sampleRate*60*this.notesPerBeat/a),this.beatMS=this.beatLength/this.sampleRate*1e3},setText:function(a){this.text.length===0&&(this.position=-1),this.text=a.toLowerCase()},setOctave:function(a){a>0&&(this.octave=a,this.keyPitches=this.getKeyPitches())},setKey:function(a){this.key=a,this.keyPitches=this.getKeyPitches()},getAllPitches:function(){var b=440,c=-48,d,e,f=[];for(d=0;d<88;d++)e=b*Math.pow(a.semitone,c+d),f[d]=e;return f},getKeyPitches:function(){var a=0,b=this.key.substr(0,1).toLowerCase(),c=this.key.substr(1,1).toLowerCase();switch(b){case"c":a=3;break;case"d":a=5;break;case"e":a=7;break;case"f":a=8;break;case"g":a=10;break;case"a":a=12;break;case"b":a=14}var d=1;c==="#"?(a++,d=2):c==="b"&&(a--,d=2);var e=this.key.substr(d).toLowerCase();e.length===0&&(e="maj"),this.isMinor=e==="min"?!0:!1;switch(e){case"maj":return this.getMajorKeyPitches(a);case"min":return this.getMinorKeyPitches(a);default:return this.getMajorKeyPitches(a)}},getMajorKeyPitches:function(a){var b=a+(this.octave-1)*12,c=26,d=0,e=0,f=[];for(var g=0;g<c;g++)f.push(this.allPitches[b]),e===2||e===6||e===9||e===13||e===16||e===20||e===23||e===27?b++:b+=2,e++;return f},getMinorKeyPitches:function(a){var b=a+(this.octave-1)*12,c=26,d=0,e=0,f=[];for(var g=0;g<c;g++)f.push(this.allPitches[b]),e===1||e===4||e===8||e===11||e===15||e===18||e===22||e===25?b++:b+=2,e++;return f},changeKey:function(a){this.key=a,this.keyPitches=this.getKeyPitches()},getOperatorAtPosition:function(a){var b=this.text.substr(a,2);return b===" #"||b==="! "?(this.quickNoteLimit=3,2):b===", "||b===" ?"?(this.quickNoteLimit=5,2):b===". "||b===": "?(this.quickNoteLimit=9,2):b===" ("||b===") "?(this.quickNoteLimit=7,2):b===" @"?3:b[0]==="."?(this.quickNoteLimit=7,2):b[0]===" "?(this.operatorInterval=7,1):b[0]==="/"?(this.operatorInterval=this.isMinor?3:4,1):b[0]==="'"?(this.operatorInterval=12,1):0},getPitchAtPosition:function(a){var b=this.text.charCodeAt(a)-97;return b>=0&&b<=25?this.keyPitches[b]:0}},audioLib.generators("Transformer",b),a}(txt2sound||{}),txt2sound=function(a){var b,c=!1,d=2,e=240,f="D",g,h=function(a,b){if(c){var d;for(var e=0;e<a.length;e+=b){g.generate();for(d=0;d<b;d++)a[e+d]=g.getMix(d)}}};return b=audioLib.AudioDevice(h,a.channels),g=audioLib.generators.Transformer(b.sampleRate,a.channels,e,f,d),a.transformer=g,a.play=function(){c||(c=!0)},a.stop=function(){c&&(c=!1)},a.setText=function(a){g.setText(a)},a.getPreviousChars=function(){return g.previousChars},a.getNextChars=function(){return g.nextChars},a.getCurrentChar=function(){return g.currentChar},a.charChanged=function(a){g.charChanged=a},a.changeReverbSize=function(a){g.reverb=audioLib.Reverb(b.sampleRate,channels,g.reverb.wet,g.reverb.dry,a,g.reverb.damping)},a}(txt2sound||{});